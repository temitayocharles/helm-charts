# Laravel Monolith - Default Configuration

replicaCount: 2

image:
  repository: cila-health/monolith
  tag: latest
  pullPolicy: IfNotPresent

imagePullSecrets: []
service:
  type: ClusterIP
  port: 80
  annotations:
    prometheus.io/scrape: "true"
    prometheus.io/port: "80"

ingress:
  enabled: true
  className: traefik
  annotations:
    traefik.ingress.kubernetes.io/router.entrypoints: web
  hosts:
    - host: monolith.dev.cila.local
      paths:
        - path: /
          pathType: Prefix
  tls: []

database:
  host: "cila-health-monolith-postgresql"
  port: 5432
  name: "cila_monolith"
  user: "cila"
  password: "cila-pass"
  sslMode: prefer

appKey: "base64:ZGV2LW1vbm9saXRoLWtleS0xMjM0NTY3ODkwMTIzNDU2Nzg5MA=="

redis:
  enabled: true
  host: "cila-health-monolith-redis-master"
  port: 6379
  image:
    repository: bitnami/redis
    tag: latest
  auth:
    enabled: false

postgresql:
  enabled: true
  image:
    repository: bitnami/postgresql
    tag: latest
  auth:
    username: cila
    password: cila-pass
    database: cila_monolith
    postgresPassword: cila-postgres-pass

resources:
  requests:
    memory: "512Mi"
    cpu: "500m"
  limits:
    memory: "1Gi"
    cpu: "1000m"

# Run Laravel migrations at pod start (safe for single replica + dev clusters).
migrations:
  enabled: false

# Monolith-specific: PHP configuration
php:
  memoryLimit: "256M"
  maxExecutionTime: 300
  uploadMaxFilesize: "100M"

# Feature flags for Strangler Fig
features:
  deviceIngestion:
    enabled: false  # When true, redirects device API calls to microservice
    microserviceUrl: "http://device-ingestion.apps.svc.cluster.local:8000"
  telemetry:
    authBypass: false
